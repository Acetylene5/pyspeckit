

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Monte Carlo examples &mdash; pyspeckit 0.1.7 documentation</title>
    
    <link rel="stylesheet" href="_static/extra.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.7',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/logo.ico"/>
    <link rel="top" title="pyspeckit 0.1.7 documentation" href="index.html" />
    <link rel="up" title="Examples" href="examples.html" />
    <link rel="next" title="A guide to interactive fitting" href="interactive.html" />
    <link rel="prev" title="A guide to interactive fitting" href="interactive.html" />
     
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setDomainName', 'pyspeckit.bitbucket.org']);
      _gaq.push(['_setAllowHash', false]);
      _gaq.push(['_trackPageview']);


    </script>
    <link rel="stylesheet" type="text/css" href="_static/extra.css" />
  </head>
  <body>
    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="http://pyspeckit.bitbucket.org">
            <img class="logo" src="_static/logo.png" alt="Logo"/>
          </a></p>
        <h1><a href="index.html">pyspeckit 0.1.7 documentation</a></h1>
        <div class="rel">
          <a href="http://pyspeckit.bitbucket.org/">PySpecKit Home </a>  |
          <a href=index.html>Docs Home </a>  |
          <a href="https://bitbucket.org/pyspeckit/pyspeckit.bitbucket.org/overview">Bitbucket Home </a>  |
          <a href="https://bitbucket.org/pyspeckit/pyspeckit.bitbucket.org/wiki/Home">Wiki</a>  |
          <a href=search.html>Search </a>
        </div>
       </div>
    </div>

    <div class="content-wrapper">
      <div class="content">
        <div class="document">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="monte-carlo-examples">
<h1>Monte Carlo examples<a class="headerlink" href="#monte-carlo-examples" title="Permalink to this headline">Â¶</a></h1>
<p>There are (at least) two packages implementing Monte Carlo sampling available
in python: <a class="reference external" href="http://code.google.com/p/pymc/">pymc</a> and <a class="reference external" href="http://danfm.ca/emcee/">emcee</a>.  <cite>pyspeckit</cite> implements interfaces to both.  With
the pymc interface, it is possible to define priors that strictly limit the
parameter space.  So far that is not possible with emcee.</p>
<p>The examples below use a custom plotting package from <a class="reference external" href="http://code.google.com/p/agpy/">agpy</a>.  It is a relatively simple but convenient
wrapper around numpy&#8217;s histogram2d.  <a class="reference external" href="http://code.google.com/p/agpy/source/browse/trunk/agpy/pymc_plotting.py">pymc_plotting</a>
takes care of indexing, percentile determination, and coloring.</p>
<dl class="docutils">
<dt>::</dt>
<dd><p class="first">import pyspeckit</p>
<p># Create our own gaussian cetered at 0 with width 1, amplitude 5, and
# gaussian noise with amplitude 1
x = pyspeckit.units.SpectroscopicAxis(np.linspace(-10,10,50), unit=&#8217;km/s&#8217;)
e = np.random.randn(50)
d = np.exp(-np.asarray(x)**2/2.)*5 + e</p>
<p># create the spectrum object
sp = pyspeckit.Spectrum(data=d, xarr=x, error=np.ones(50)*e.std())
# fit it
sp.specfit(fittype=&#8217;gaussian&#8217;)
# then get the pymc values
MCuninformed = sp.specfit.get_pymc()
MCwithpriors = sp.specfit.get_pymc(use_fitted_values=True)
MCuninformed.sample(5000,burn=1000,tune_interval=250)
MCwithpriors.sample(5000,burn=1000,tune_interval=250)</p>
<p># MC vs least squares:
print sp.specfit.parinfo
# Param #0       HEIGHT =       0.0109281 +/-        0.195809
# Param #1   AMPLITUDE0 =         4.57169 +/-        0.651568
# Param #2       SHIFT0 =     0.000182704 +/-        0.205333
# Param #3       WIDTH0 =         1.23275 +/-        0.219416   Range:   [0,inf)</p>
<p>print MCuninformed.stats()[&#8216;AMPLITUDE0&#8217;],MCuninformed.stats()[&#8216;WIDTH0&#8217;]
# {&#8216;95% HPD interval&#8217;: array([ 2.80477894,  5.19230514]),
#  &#8216;mc error&#8217;: 0.0096630856947778534,
#  &#8216;mean&#8217;: 3.8550042004763823,
#  &#8216;n&#8217;: 4000,
#  &#8216;quantiles&#8217;: {2.5: 2.7001147437515614,
#   25: 3.4136653207924721,
#   50: 3.8216640136271343,
#   75: 4.2658237064708775,
#   97.5: 5.1241797879905224},
#  &#8216;standard deviation&#8217;: 0.61114720041777293}
# {&#8216;95% HPD interval&#8217;: array([ 0.72443531,  1.56684083]),
#  &#8216;mc error&#8217;: 0.0035649461062602994,
#  &#8216;mean&#8217;: 1.1868052003204772,
#  &#8216;n&#8217;: 4000,
#  &#8216;quantiles&#8217;: {2.5: 0.7886369815120019,
#   25: 1.030731243691529,
#   50: 1.1608275996051221,
#   75: 1.3238167303614339,
#   97.5: 1.6719731801069622},
#  &#8216;standard deviation&#8217;: 0.22546698863062389}</p>
<p>print MCwithpriors.stats()[&#8216;AMPLITUDE0&#8217;],MCwithpriors.stats()[&#8216;WIDTH0&#8217;]
# {&#8216;95% HPD interval&#8217;: array([ 3.14723955,  4.75558755]),
#  &#8216;mc error&#8217;: 0.0066693160876581236,
#  &#8216;mean&#8217;: 4.0120510164373284,
#  &#8216;n&#8217;: 4000,
#  &#8216;quantiles&#8217;: {2.5: 3.1905811738800782,
#   25: 3.7258959755336791,
#   50: 4.0192907032241969,
#   75: 4.2848569265514413,
#   97.5: 4.8263499154520932},
#  &#8216;standard deviation&#8217;: 0.42180458545205723},
# {&#8216;95% HPD interval&#8217;: array([ 0.84659241,  1.37188539]),
#  &#8216;mc error&#8217;: 0.0021143746687207888,
#  &#8216;mean&#8217;: 1.132295044520145,
#  &#8216;n&#8217;: 4000,
#  &#8216;quantiles&#8217;: {2.5: 0.87023370176467096,
#   25: 1.0471063188439775,
#   50: 1.1319776513946447,
#   75: 1.2149336329380425,
#   97.5: 1.4028230972640638},
#  &#8216;standard deviation&#8217;: 0.13372479560243336}</p>
<p># optional
import agpy.pymc_plotting
import pylab
agpy.pymc_plotting.hist2d(MCuninformed,&#8217;AMPLITUDE0&#8217;,&#8217;WIDTH0&#8217;,clear=True)
agpy.pymc_plotting.hist2d(MCwithpriors,&#8217;AMPLITUDE0&#8217;,&#8217;WIDTH0&#8217;,contourcmd=pylab.contour,colors=[(0,1,0,1),(0,0.5,0.5,1),(0,0.75,0.75,1),(0,1,1,1),(0,0,1,1)],clear=False)</p>
<p># Now do the same with emcee
emcee_ensemble = sp.specfit.get_emcee()
p0 = emcee_ensemble.p0 * (np.random.randn(<a href="#id1"><span class="problematic" id="id2">*</span></a>emcee_ensemble.p0.shape) / 10. + 1.0)
pos,logprob,state = emcee_ensemble.run_mcmc(p0,4000)</p>
<dl class="docutils">
<dt>plotdict = {&#8216;AMPLITUDE0&#8217;:emcee_ensemble.chain[:,:,1].ravel(),</dt>
<dd>&#8216;WIDTH0&#8217;:emcee_ensemble.chain[:,:,3].ravel()}</dd>
</dl>
<p class="last">agpy.pymc_plotting.hist2d(plotdict,&#8217;AMPLITUDE0&#8217;,&#8217;WIDTH0&#8217;,fignum=2)</p>
</dd>
</dl>
<div class="figure" style="width: 800">
<img alt="Examples of the pymc Monte Carlo two-dimensional parameter histogram (marginalized over X-offset and Y-offset) with and without priors; with priors is shown in contour lines" src="../images/pymc_params_example.png" style="width: 800px;" />
</div>
<div class="figure" style="width: 800">
<img alt="../images/emcee_params_example.png:alt:Sameasabove,butusingemcee" src="../images/emcee_params_example.png:alt:Sameasabove,butusingemcee" style="width: 800px;" />
</div>
</div>


          </div>
        </div>
      </div>
        </div>
        <div class="sidebar">
          <h3>Table Of Contents</h3>
          <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation and Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models &amp; Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="features.html">Class Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="readers.html">File Readers</a></li>
<li class="toctree-l1"><a class="reference internal" href="wrappers.html">High-Level Wrappers</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="example_h2co.html">Radio H2CO</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_nh3.html">Radio NH3</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_hcop.html">Radio HCO+</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_sdss.html">Optical SDSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_vega_echelle.html">Optical Vega Echelle</a></li>
<li class="toctree-l2"><a class="reference internal" href="interactive.html">Optical INTERACTIVE</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Monte Carlo</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interactive.html">Interactive Use</a></li>
</ul>

          <h3 style="margin-top: 1.5em;">Search</h3>
          <form class="search" action="search.html" method="get">
            <input type="text" name="q" />
            <input type="submit" value="Go" />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
          </form>
          <p class="searchtip" style="font-size: 90%">
            Enter search terms or a module, class or function name.
          </p>
        </div>
        <div class="clearer"></div>
      </div>
    </div>

    <div class="footer">
    <table width=800><tr>
            <td align=left>
      &copy; Copyright 2011, Adam Ginsburg and Jordan Mirocha.
    </td>
    <td align=right><a href="mailto:pyspeckit@gmail.com">Contact us</a></td>
    </tr>
    <tr><td>
      Last updated on Apr 10, 2012.
    </td><td align=right>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
    </td>
    <tr>
            <td align=left><a href="pyspeckit.pdf">PDF version of this document</a></td>
    </tr></table>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-6253200-7']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
        
    </div>
  </body>
</html>